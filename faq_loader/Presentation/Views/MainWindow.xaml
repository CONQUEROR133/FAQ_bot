<Window x:Class="UniversalFAQLoader.Presentation.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:UniversalFAQLoader.Presentation.Views"
        xmlns:controls="clr-namespace:UniversalFAQLoader.Presentation.Controls"
        mc:Ignorable="d"
        Title="🚀 Универсальный FAQ Загрузчик - Алгоритмическое управление" 
        Height="800" Width="1200"
        WindowStartupLocation="CenterScreen">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Главное меню -->
        <Menu Grid.Row="0">
            <MenuItem Header="Файл">
                <MenuItem Header="Загрузить FAQ данные" Command="{Binding LoadFAQDataCommand}"/>
                <MenuItem Header="Очистить данные" Command="{Binding ClearFAQDataCommand}"/>
                <Separator/>
                <MenuItem Header="Выход" Click="ExitMenuItem_Click"/>
            </MenuItem>
            <MenuItem Header="Алгоритмы">
                <MenuItem Header="Выполнить все алгоритмы" Command="{Binding ExecuteAllAlgorithmsCommand}"/>
                <Separator/>
                <MenuItem Header="Настройки алгоритмов" Click="AlgorithmSettingsMenuItem_Click"/>
            </MenuItem>
            <MenuItem Header="Справка">
                <MenuItem Header="О программе" Click="AboutMenuItem_Click"/>
            </MenuItem>
        </Menu>

        <!-- Основная область -->
        <TabControl Grid.Row="1" Margin="10">
            <!-- Вкладка загрузки файлов -->
            <TabItem Header="📁 Загрузка файлов">
                <Grid Margin="10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="250"/>
                    </Grid.ColumnDefinitions>

                    <!-- Область перетаскивания файлов -->
                    <Border Grid.Column="0" BorderBrush="LightGray" BorderThickness="2" 
                            Background="WhiteSmoke" Margin="0,0,10,0"
                            AllowDrop="True" Drop="FileDropArea_Drop" DragEnter="FileDropArea_DragEnter">
                        <Grid>
                            <TextBlock Text="Перетащите файлы сюда или нажмите кнопку ниже" 
                                       HorizontalAlignment="Center" VerticalAlignment="Center" 
                                       Foreground="Gray" FontSize="14"/>
                            <Button Content="Выбрать файлы..." 
                                    HorizontalAlignment="Center" VerticalAlignment="Bottom" 
                                    Margin="0,0,0,20" Padding="20,10" 
                                    Background="#2196F3" Foreground="White" 
                                    FontSize="14" FontWeight="Bold"
                                    Click="SelectFilesButton_Click"/>
                        </Grid>
                    </Border>

                    <!-- Панель настроек -->
                    <StackPanel Grid.Column="1" Margin="10,0,0,0">
                        <TextBlock Text="Настройки загрузки:" FontWeight="Bold" Margin="0,0,0,10"/>
                        
                        <CheckBox x:Name="GroupFilesCheckBox" Content="Группировать файлы" IsChecked="True" Margin="0,0,0,5"/>
                        <CheckBox x:Name="CopyToFilesCheckBox" Content="Копировать в папку Files" IsChecked="True" Margin="0,0,0,5"/>
                        <CheckBox x:Name="CreateButtonsCheckBox" Content="Создавать кнопки для бота" IsChecked="True" Margin="0,0,0,15"/>
                        
                        <TextBlock Text="Название группы:" Margin="0,0,0,5"/>
                        <TextBox x:Name="GroupNameTextBox" Text="Альфа" Margin="0,0,0,15"/>
                        
                        <Button Content="🚀 Загрузить в FAQ" 
                                Background="#4CAF50" Foreground="White" 
                                Padding="10,5" Margin="0,0,0,20"
                                Click="LoadToFAQButton_Click"/>
                        
                        <TextBlock Text="Статус:" FontWeight="Bold" Margin="0,0,0,5"/>
                        <TextBlock x:Name="StatusTextBlock" Text="Готов к загрузке" Foreground="Green"/>
                    </StackPanel>
                </Grid>
            </TabItem>
            
            <!-- Вкладка алгоритмического управления -->
            <TabItem Header="🧠 Алгоритмы">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="300"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Панель управления алгоритмами -->
                    <StackPanel Grid.Column="0" Margin="10">
                        <TextBlock Text="Активные алгоритмы:" FontWeight="Bold" Margin="0,0,0,10"/>
                        
                        <CheckBox Content="🔍 Анализ зависимостей" IsChecked="{Binding Algorithms[0].IsEnabled}" Margin="0,0,0,5"/>
                        <CheckBox Content="🎯 Семантическая группировка" IsChecked="{Binding Algorithms[1].IsEnabled}" Margin="0,0,0,5"/>
                        <CheckBox Content="🔗 Умное связывание" IsChecked="{Binding Algorithms[2].IsEnabled}" Margin="0,0,0,5"/>
                        <CheckBox Content="⚡ Оптимизация ответов" IsChecked="{Binding Algorithms[3].IsEnabled}" Margin="0,0,0,15"/>
                        
                        <Separator Margin="0,10"/>
                        
                        <TextBlock Text="Настройки:" FontWeight="Bold" Margin="0,0,0,10"/>
                        <StackPanel>
                            <TextBlock Text="Порог семантической схожести:"/>
                            <Slider Value="0.8" Minimum="0.5" Maximum="1.0" 
                                    TickPlacement="BottomRight" TickFrequency="0.1" Margin="0,0,0,10"/>
                            
                            <TextBlock Text="Максимум связей на узел:"/>
                            <Slider Value="5" Minimum="1" Maximum="20" 
                                    TickPlacement="BottomRight" TickFrequency="1" Margin="0,0,0,20"/>
                        </StackPanel>
                        
                        <Button Content="🚀 Применить алгоритмы" 
                                Command="{Binding ExecuteAllAlgorithmsCommand}"
                                Background="#2196F3" Foreground="White" 
                                Padding="10,5" Margin="0,0,0,20"/>
                        
                        <TextBlock Text="Статус выполнения:" FontWeight="Bold" Margin="0,0,0,5"/>
                        <ProgressBar Value="{Binding ProgressPercentage}" Height="20" Margin="0,0,0,5"/>
                        <TextBlock Text="{Binding StatusMessage}" TextWrapping="Wrap" Foreground="Blue"/>
                    </StackPanel>
                    
                    <!-- Визуализация FAQ графа -->
                    <Border Grid.Column="1" BorderBrush="Gray" BorderThickness="1" Margin="10">
                        <controls:FAQGraphVisualization x:Name="FAQGraph"/>
                    </Border>
                </Grid>
            </TabItem>
            
            <!-- Вкладка результатов анализа -->
            <TabItem Header="📊 Результаты">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Сводка результатов -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                        <Border Background="#E3F2FD" Padding="10" Margin="0,0,10,0">
                            <StackPanel>
                                <TextBlock Text="Обработано узлов" FontWeight="Bold"/>
                                <TextBlock Text="15" FontSize="20" Foreground="#2196F3"/>
                            </StackPanel>
                        </Border>
                        
                        <Border Background="#E8F5E9" Padding="10" Margin="0,0,10,0">
                            <StackPanel>
                                <TextBlock Text="Найдено связей" FontWeight="Bold"/>
                                <TextBlock Text="42" FontSize="20" Foreground="#4CAF50"/>
                            </StackPanel>
                        </Border>
                        
                        <Border Background="#FFF3E0" Padding="10" Margin="0,0,10,0">
                            <StackPanel>
                                <TextBlock Text="Предложений" FontWeight="Bold"/>
                                <TextBlock Text="8" FontSize="20" Foreground="#FF9800"/>
                            </StackPanel>
                        </Border>
                        
                        <Border Background="#FFEBEE" Padding="10">
                            <StackPanel>
                                <TextBlock Text="Время выполнения" FontWeight="Bold"/>
                                <TextBlock Text="2.3 сек" FontSize="20" Foreground="#F44336"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                    
                    <!-- Детали результатов -->
                    <TabControl Grid.Row="1">
                        <TabItem Header="Связи">
                            <DataGrid Margin="5" AutoGenerateColumns="False" IsReadOnly="True">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Тип связи" Binding="{Binding Type}" Width="*"/>
                                    <DataGridTextColumn Header="Исходный узел" Binding="{Binding SourceNodeId}" Width="*"/>
                                    <DataGridTextColumn Header="Целевой узел" Binding="{Binding TargetNodeId}" Width="*"/>
                                    <DataGridTextColumn Header="Сила" Binding="{Binding Strength}" Width="100"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </TabItem>
                        
                        <TabItem Header="Предложения">
                            <DataGrid Margin="5" AutoGenerateColumns="False" IsReadOnly="True">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Тип" Binding="{Binding Type}" Width="150"/>
                                    <DataGridTextColumn Header="Описание" Binding="{Binding Description}" Width="*"/>
                                    <DataGridTextColumn Header="Приоритет" Binding="{Binding Priority}" Width="100"/>
                                    <DataGridTextColumn Header="Уверенность" Binding="{Binding Confidence}" Width="100"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </TabItem>
                        
                        <TabItem Header="Статистика">
                            <Grid Margin="10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                    <TextBlock Text="Общая статистика:" FontWeight="Bold" Margin="0,0,0,10"/>
                                    <TextBlock Text="• Время выполнения: 2.3 секунды"/>
                                    <TextBlock Text="• Использовано памяти: 15 МБ"/>
                                    <TextBlock Text="• Обработано узлов: 15"/>
                                    <TextBlock Text="• Найдено связей: 42"/>
                                    <TextBlock Text="• Средняя уверенность: 85%"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="По алгоритмам:" FontWeight="Bold" Margin="0,0,0,10"/>
                                    <TextBlock Text="• Анализ зависимостей: 18 связей"/>
                                    <TextBlock Text="• Семантическая группировка: 3 группы"/>
                                    <TextBlock Text="• Умное связывание: 15 связей"/>
                                    <TextBlock Text="• Оптимизация ответов: 6 улучшений"/>
                                </StackPanel>
                            </Grid>
                        </TabItem>
                    </TabControl>
                </Grid>
            </TabItem>
        </TabControl>

        <!-- Статус бар -->
        <StatusBar Grid.Row="2" Background="LightGray">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}" FontWeight="Bold"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Узлов FAQ: "/>
                    <TextBlock Text="{Binding FAQNodes.Count}"/>
                </StackPanel>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Алгоритмы: "/>
                    <TextBlock Text="{Binding Algorithms.Count}"/>
                </StackPanel>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>